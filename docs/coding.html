<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Madeline G. Eppley - Coding, GitHub, and Bioinformatics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta name="twitter:title" content="Madeline G. Eppley - Coding, GitHub, and Bioinformatics">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Madeline G. Eppley</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./labnotebook.html" rel="" target="">
 <span class="menu-text">Lab Notebook</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./coding.html" rel="" target="" aria-current="page">
 <span class="menu-text">Coding and Bioinfomatics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./resources.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/madeline-eppley" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/MadelineGEppley" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/madeline-eppley/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://cos.northeastern.edu/people/madeline-eppley/" rel="" target=""><i class="bi bi-mortarboard-fill" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.madeline-eppley.com" rel="" target=""><i class="bi bi-laptop" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#creating-a-quarto-website-with-github" id="toc-creating-a-quarto-website-with-github" class="nav-link active" data-scroll-target="#creating-a-quarto-website-with-github">Creating a Quarto Website with GitHub</a></li>
  <li><a href="#population-genomics" id="toc-population-genomics" class="nav-link" data-scroll-target="#population-genomics">Population Genomics</a>
  <ul class="collapse">
  <li><a href="#imputing-snp-datasets" id="toc-imputing-snp-datasets" class="nav-link" data-scroll-target="#imputing-snp-datasets">Imputing SNP Datasets</a></li>
  </ul></li>
  <li><a href="#why-impute" id="toc-why-impute" class="nav-link" data-scroll-target="#why-impute">Why impute?</a></li>
  <li><a href="#recommended-pre-reading" id="toc-recommended-pre-reading" class="nav-link" data-scroll-target="#recommended-pre-reading">Recommended pre-reading</a></li>
  <li><a href="#lea-and-impute" id="toc-lea-and-impute" class="nav-link" data-scroll-target="#lea-and-impute">LEA and <code>impute()</code></a></li>
  <li><a href="#full-vs-thinned-snp-sets" id="toc-full-vs-thinned-snp-sets" class="nav-link" data-scroll-target="#full-vs-thinned-snp-sets">Full vs thinned SNP sets</a></li>
  <li><a href="#general-imputation-workflow" id="toc-general-imputation-workflow" class="nav-link" data-scroll-target="#general-imputation-workflow">General imputation workflow</a></li>
  <li><a href="#step-1-preparing-your-snp-matrix" id="toc-step-1-preparing-your-snp-matrix" class="nav-link" data-scroll-target="#step-1-preparing-your-snp-matrix">Step 1: Preparing your SNP matrix</a></li>
  <li><a href="#step-2-filter-for-missing-data" id="toc-step-2-filter-for-missing-data" class="nav-link" data-scroll-target="#step-2-filter-for-missing-data">Step 2: Filter for missing data</a></li>
  <li><a href="#step-3-filter-for-maf" id="toc-step-3-filter-for-maf" class="nav-link" data-scroll-target="#step-3-filter-for-maf">Step 3: Filter for MAF</a></li>
  <li><a href="#step-4-imputing-and-producing-the-full-snp-set" id="toc-step-4-imputing-and-producing-the-full-snp-set" class="nav-link" data-scroll-target="#step-4-imputing-and-producing-the-full-snp-set">Step 4: Imputing and producing the full SNP set</a></li>
  <li><a href="#step-5-filtering-for-linkage-disequilibrium-and-producing-the-thinned-snp-set" id="toc-step-5-filtering-for-linkage-disequilibrium-and-producing-the-thinned-snp-set" class="nav-link" data-scroll-target="#step-5-filtering-for-linkage-disequilibrium-and-producing-the-thinned-snp-set">Step 5: Filtering for linkage disequilibrium and producing the thinned SNP set</a></li>
  <li><a href="#other-imputation-methods" id="toc-other-imputation-methods" class="nav-link" data-scroll-target="#other-imputation-methods">Other imputation methods</a></li>
  <li><a href="#environmental-data" id="toc-environmental-data" class="nav-link" data-scroll-target="#environmental-data">Environmental Data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Coding, GitHub, and Bioinformatics</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Here I have tutorials for coding, example outputs, and best data practices that I’ve developed through some of my PhD-related computational research.</p>
<section id="creating-a-quarto-website-with-github" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-quarto-website-with-github">Creating a Quarto Website with GitHub</h2>
<p><strong>Before getting started, you need (1) a GitHub account, (2) RStudio on your local machine, (3) GitHub desktop or Terminal, and (4) Quarto.</strong> I will complete this tutorial using GitHub Desktop, as I think it is easier to learn for those with less coding familiarity.</p>
<section id="initializing-the-website" class="level5">
<h5 class="anchored" data-anchor-id="initializing-the-website">Initializing the website</h5>
<ol class="example" type="1">
<li>In GitHub, create a new repository with the domain name that you would like for your website. For example, my repository name is ‘madeline-eppley’, so my website will be named ‘madeline-eppley.github.io’.</li>
<li>In GitHub Desktop, choose “Add Existing Repository” and paste the clone url. Alternatively, you can open the repository in GitHub, then select “Open with GitHub Desktop”. If you’re using the terminal, you can clone the repository with <code>gh repo clone repo-name/repo-name.github.io</code>.</li>
<li>If this was your first time linking a repository through GitHub Desktop, by default, GitHub Desktop will create a local folder named “GitHub” in your Documents folder (on a Mac) and place your repository there. I moved this folder into my regular user space, but you can store it anywhere you like. If you’ve already set up GitHub Desktop, your new repository will be linked in the previously created folder. Locate your local repository folder.</li>
<li>In your local R Studio, initialize a new Quarto project with “New Project” and select “Quarto Website”. Then, provide the directory name as your local repository folder. You should now see a basic <code>index.qmd</code> and <code>_quarto.yml</code> file in your directory.</li>
<li>Open your <code>_quarto.yml</code> file and add <code>output-dir: docs</code> directly under the type: website line. Save the edit.</li>
<li>Make a test edit to the <code>index.qmd</code> file and then check “Render on Save”. This will open up a locally-hosted browser where you can preview your edits. If everything looks good, you can select “Render” and will have auto-generated .html files appear in a new <code>/docs</code> folder within the repository folder.</li>
<li>Test the setup by committing these new files to GitHub through GitHub desktop. You should then see your new setup files on GitHub.</li>
</ol>
</section>
<section id="rendering-the-website" class="level5">
<h5 class="anchored" data-anchor-id="rendering-the-website">Rendering the Website</h5>
<ol start="8" class="example" type="1">
<li>Go to “Settings” in GitHub and scroll down to Pages. There, select Source “Deploy from a branch” and edit the branch so that it renders from the <code>/docs</code> folder in the main branch. The folder that you select should be where your .html files are stored, so after this point, do NOT move your .html files out of the <code>/docs</code> folder.</li>
<li>At this point, GitHub will begin automatically rendering your site. Under the “Actions” tab, you can check the build and deployment status.</li>
<li>When it completes, you can return to Settings/Pages and see that your site will be live at ‘your-repo-title.github.io’. Now you can visit your site!</li>
</ol>
</section>
<section id="editing-your-website-structure" class="level5">
<h5 class="anchored" data-anchor-id="editing-your-website-structure">Editing your Website Structure</h5>
<p>Quarto websites are designed to host structure within the <code>_quarto.yml</code> file. Here, you establish your website format, image folders, style, font design, header and footer, and order of the pages. You can check out my <a href="https://github.com/madeline-eppley/madeline-eppley.github.io">_quarto.yml</a> file in my repo for inspiration!</p>
<p>Your <code>index.qmd</code> file is your first “page” and is the home screen of your website. You can add new pages at any time by adding a new .qmd file in GitHub. Each time you add a new element of “structure” (eg. a new page), you need to update the <code>_quarto.yml</code> file to add this file.</p>
<p>I typically edit my pages locally in RStudio, but it is also possible to edit them within GitHub. <a href="https://quarto.org/docs/authoring/markdown-basics.html">Standard R markdown formatting</a> also applies to .qmd files. Wherever you edit, be sure to use GitHub desktop or git to push and pull your edits. Whenever you’re ready to publish your new edits, you need to return to your local RStudio and “Render” your edited file. This step is important because it re-generates your .html file, which is what is actually used to build the website. To save myself the hassle of remembering this step, I enable “Render on Save” for all of my pages within RStudio.</p>
</section>
<section id="adding-images-to-your-website" class="level5">
<h5 class="anchored" data-anchor-id="adding-images-to-your-website">Adding Images to your Website</h5>
<p>You can add as many images to your Quarto website as you’d like! The first step is to set up your resources folder in your <code>_quarto.yml</code> file. Add <code>resources: "/img"</code> under the <code>project:</code> section at the top of the file. Next, add a high-quality (I suggest .png format) image to your <code>/img</code> folder and title it something intuitive (e.g.&nbsp;‘profile_pic.png’). To add any image in-text, add <code>![](img/image_name.png){fig-alt="Add your caption here"}</code> to your .qmd file. There are several methods to adjust image size, caption font size, etc. that you can learn more about on the <a href="https://quarto.org/docs/authoring/figures.html">Quarto website</a>.</p>
</section>
<section id="styles-icons-fonts-and-colors" class="level5">
<h5 class="anchored" data-anchor-id="styles-icons-fonts-and-colors">Styles, Icons, Fonts, and Colors</h5>
<p>Coming soon!</p>
</section>
</section>
<section id="population-genomics" class="level2">
<h2 class="anchored" data-anchor-id="population-genomics">Population Genomics</h2>
<section id="imputing-snp-datasets" class="level3">
<h3 class="anchored" data-anchor-id="imputing-snp-datasets">Imputing SNP Datasets</h3>
</section>
</section>
<section id="why-impute" class="level2">
<h2 class="anchored" data-anchor-id="why-impute">Why impute?</h2>
<p>When you receive genotype data from the sequencing facility it will be incomplete. That is, each individual will be missing some genotype calls at SNPs. However, many downstream analyses require complete data. If you reduce your data to just complete SNPs for all individuals you’ll likely end up with a very small number of useable SNPs. For example, the seascape oysters from the CviMVP project were returned from the sequencing facility with 194k SNPs, but only 14k of those are complete across all individuals. We definitely don’t want to reduce our data by that amount! So, we impute data using methods that calculate the most frequent genotype at each SNP for a designated group of samples (typically by ancestral groups) or across all individuals.</p>
</section>
<section id="recommended-pre-reading" class="level2">
<h2 class="anchored" data-anchor-id="recommended-pre-reading">Recommended pre-reading</h2>
<p>Before starting the SNP imputation and filtering process, I recommend reading the following:</p>
<ol type="1">
<li><p><a href="https://onlinelibrary.wiley.com/doi/full/10.1111/1755-0998.13366">LEA 3: Factor models in population genetics and ecological genomics with R</a>, Gain et al 2021</p></li>
<li><p><a href="https://onlinelibrary.wiley.com/doi/full/10.1111/mec.14792">These aren’t the loci you’re looking for: Principles of effective SNP filtering for molecular ecologists</a>, O’Leary et al 2018</p></li>
<li><p><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC3982712/">Fast and Efficient Estimation of Individual Ancestry Coefficients</a>, Frichot et al 2014</p></li>
</ol>
<p>If you’re short on time, readings 1 and 2 are the most important. The third reading dives further into the ancestry calculations in snmf that we will use for imputation.</p>
</section>
<section id="lea-and-impute" class="level2">
<h2 class="anchored" data-anchor-id="lea-and-impute">LEA and <code>impute()</code></h2>
<p>We will be using the impute() function in the LEA package to impute our missing genotypes with the output of an snmf object (.lfmm file). The function takes the following arguments: <code>impute (object, input.file, method, K, run)</code>. See more details <a href="https://rdrr.io/bioc/LEA/man/impute.html">here</a>. The imputation works by using ancestry and genotype frequency estimates from an snmf run and using the mode for each genotype within the assigned ancestral group. the method of imputation is either set to mode or random. With “random”, imputation is performed by using the genotype probabilities. With “mode”, the most likely genotype is used for matrix completion. Since LEA is imputing using a K = n specified number of ancestral groups, it can potentially introduce structure into the dataset. If you are concerned about this potential introduction of structure, compare Fst values pre- and post- imputation (using a complete set of filtered SNPs for the ‘pre-imputation’ SNP set).</p>
</section>
<section id="full-vs-thinned-snp-sets" class="level2">
<h2 class="anchored" data-anchor-id="full-vs-thinned-snp-sets">Full vs thinned SNP sets</h2>
<p>It is important to understand what type of SNPs you want to retain in your dataset for downstream anaylses. Your full SNP set will be all SNPs that are retained after filtering for missingness and MAF and imputed. Your thinned SNP set will be a subsetted version of the full SNP set that removes SNPs in LD. Generally, you want to use a full SNP set for detecing selection and functional loci detection (e.g.&nbsp;gene ontology), and use a thinned SNP set for population structure (e.g.&nbsp;PCA, ancestry/structure).</p>
</section>
<section id="general-imputation-workflow" class="level2">
<h2 class="anchored" data-anchor-id="general-imputation-workflow">General imputation workflow</h2>
<ol type="1">
<li>Transfer your data into a genotype matrix format. We have developed code for extracting genotype values from a VCF using the <code>extract.gt()</code> function (see <a href="https://drk-lo.github.io/lotterhoslabprotocols/code_imputation.html#preparing-your-snp-matrix">Preparing SNP matrix</a> section below).<br>
</li>
<li>Filter for missing data. This typically includes: removing low-quality calls (often done by the sequencing facility, but double-check), removing individuals with &gt;10% missing data across all loci, and removing SNPs with &gt;10% missing data across all individuals.</li>
<li>Filter for minor allele frequency (MAF)</li>
<li>Impute</li>
</ol>
<ol type="i">
<li>THIS STEP PRODUCES YOUR FULL SNP DATASET<br>
</li>
</ol>
<ol start="5" type="1">
<li>Filter your full SNP dataset for linkage disequilibrium</li>
</ol>
<ol type="i">
<li>THIS STEP PRODUCES YOUR THINNED SNP DATASET</li>
</ol>
</section>
<section id="step-1-preparing-your-snp-matrix" class="level2">
<h2 class="anchored" data-anchor-id="step-1-preparing-your-snp-matrix">Step 1: Preparing your SNP matrix</h2>
<p>To prepare to use the <code>impute()</code> function, you should arrage your SNP data in a matrix with individuals in rows and your SNPs in columns. If you’re starting with a VCF file of genotypes from the sequencing facility, use the <code>extract.gt()</code> function to extract the genotype values into a data frame from the VCF. For an example on how to do this, ask for access to the <code>genotypes_experimental.R</code> script that was used for the Cvi MVP H2F project.</p>
</section>
<section id="step-2-filter-for-missing-data" class="level2">
<h2 class="anchored" data-anchor-id="step-2-filter-for-missing-data">Step 2: Filter for missing data</h2>
<p>The threshold of missing data can change depending on your dataset. For our Cvi MVP samples, we decided to use a 10% missingness threshold (e.g.&nbsp;any individual or loci that has more than 10% missing data across the entire data set will be removed). Here in this example, our SNP matrix is called <code>exp_ordered</code> and contains sequenced individuals in rows, SNPs in columns. We detect 2.9k SNPs that are above the threshold of 0.10 and remove them, producing a reduced data frame called <code>exp_cleaned_columns</code>. The same is repeated with the rows, but no individuals are detected that exceed the missingness threshold (yay, good data!). We also have a separate mutations dataframe that stores some functional annotations of the SNPs, so I also subset that <code>muts_filtered</code> to produce an equal number of retained SNPs as my genotype matrix.</p>
<pre><code># look at where our data is missing in rows
hist_rows &lt;- rowSums(is.na(exp_ordered))
hist(hist_rows)

# look at where our data is missing in columns
cols_hist &lt;- colSums(is.na(exp_ordered))
hist(cols_hist)

# Filter out cols with missing data
missing_threshold &lt;- 0.10  #10%
snp_missing_prop &lt;- colMeans(is.na(exp_ordered))
exp_cleaned_columns &lt;- exp_ordered[, snp_missing_prop &lt;= missing_threshold]
dim(exp_cleaned_columns) # removed 2976 SNPs

# Filter out the rows with missing data
ind_missing_prop &lt;- rowMeans(is.na(exp_ordered))
inds_missing &lt;- which(ind_missing_prop &gt; missing_threshold) # length 0, all inds pass

# filter the muts database to just keep our SNPs that meet the missingness threshold
muts_filtered &lt;- muts[snp_missing_prop &lt;= missing_threshold, ]
dim(muts_filtered) #191994 SNPs</code></pre>
</section>
<section id="step-3-filter-for-maf" class="level2">
<h2 class="anchored" data-anchor-id="step-3-filter-for-maf">Step 3: Filter for MAF</h2>
<p>This step shows how to filter for MAF. Our genotype matrix <code>exp_cleaned_columns_sort</code> has been filtered for missingness and now sorted to have the rows and columns in the exact same order as our mutation matrix and individual matrix. We use a custom function to calculate the allele frequency (af) within each column, and then apply that custom function to each column in the genotype matrix. The <code>maf_threshold</code> can be set to whatever threshold you’d like for your data, here we use 0.05, meaning SNPs that appear in less than 5% of individuals are filtered out. These are “minor alleles” and because of their rarity across the dataset, could bias population estimates. Once we complete this filtering, we are left with n = 154k SNPs, and this will be the dataset that we impute.</p>
<pre><code># The geno matrix has individuals in rows and mutations in columns, with a 0, 1, or 2 entered for the number of alternate alleles in the diploid

GEN &lt;- exp_cleaned_columns_sort

# function to calculate the allele frequency of a column
af &lt;- function(i, GEN){
  sum(GEN[,i], na.rm=TRUE)/(2*sum(!is.na(GEN[,i])))
}
# af(1, GEN)

# calculate the allele freq of SNPs in the geno mat
snp_afs &lt;- apply(GEN, 2, function(i){
  sum(i, na.rm=TRUE)/(2*sum(!is.na(i)))})

# calculate MAF 
maf_threshold &lt;- 0.05
keep_snps &lt;- names(snp_afs[snp_afs &gt;= maf_threshold &amp; snp_afs &lt;= (1 - maf_threshold)]) # vector with SNPs above 0.05

# now filter the GEN matrix for MAF
GEN_filtered &lt;- GEN[, keep_snps]
dim(GEN_filtered) #154609 SNPs

# filter the muts data frame to just keep our SNPs with full data
muts_maf_filtered &lt;- muts_filt_ord[muts_filt_ord$Affx.ID %in% keep_snps, ]
dim(muts_maf_filtered) #154609 SNPs
saveRDS(muts_maf_filtered, file = "merged_data/genotypes/20250203_FULLmuts_exp.rds")</code></pre>
</section>
<section id="step-4-imputing-and-producing-the-full-snp-set" class="level2">
<h2 class="anchored" data-anchor-id="step-4-imputing-and-producing-the-full-snp-set">Step 4: Imputing and producing the full SNP set</h2>
<p>Here we have our filtered SNP matrix called <code>GEN_filtered</code>. This matrix has been filtered for MAF and missingness and contains 154k SNPs. In this example, we impute for a value of K = 2.</p>
<pre><code># Impute #####################################################################
# use snmf on our genotype matrix with 154k SNPs
write.lfmm(GEN_filtered, "merged_data/genotypes/20250203_genotypes_exp.lfmm")

exp.project.snmf &lt;- snmf("merged_data/genotypes/20250203_genotypes_exp.lfmm", K = 2, repetitions = 10, ploidy = 2, entropy = TRUE, project = "new")

# run with the lowest cross-entropy value and impute
best = which.min(cross.entropy(exp.project.snmf, K = 2))
impute(exp.project.snmf, "merged_data/genotypes/20250203_genotypes_exp.lfmm", method = 'mode', K = 2, run = best)

# store the imputed SNP set as a matrix 
GEN_imputed &lt;- as.data.frame(read.table("merged_data/genotypes/20250203_genotypes_exp.lfmm_imputed.lfmm", header = FALSE))
saveRDS(GEN_imputed, file = "merged_data/genotypes/20250203_FULLSNPs_exp.rds") # this is the FULL SNP set</code></pre>
</section>
<section id="step-5-filtering-for-linkage-disequilibrium-and-producing-the-thinned-snp-set" class="level2">
<h2 class="anchored" data-anchor-id="step-5-filtering-for-linkage-disequilibrium-and-producing-the-thinned-snp-set">Step 5: Filtering for linkage disequilibrium and producing the thinned SNP set</h2>
<p>Here, we read in the thinned SNP set and use the <code>bigsnpr</code> and <code>bigstatsr</code> packages to calculate a PCA while filtering for LD. The LD correlation argument is set of a default of <code>thr.r2 = 0.2</code>, but this can be explored for your data.</p>
<pre><code>GEN_imputed &lt;- readRDS("/Users/madelineeppley/Desktop/20250203_FULLSNPs_exp.rds")
gen_impute &lt;- add_code256(big_copy(GEN_imputed,type="raw"),code=bigsnpr:::CODE_012)

# double check our dimensions
muts_maf_filtered &lt;- readRDS("/Users/madelineeppley/Desktop/20250203_FULLmuts_exp.rds")
dim(GEN_imputed)
dim(muts_maf_filtered) # matches

thr.r2 &lt;- 0.2
# create the thinned SNP set 
pca_inv &lt;- snp_autoSVD(gen_impute,
                       infos.chr= muts_maf_filtered$Chromosome,
                       infos.pos = muts_maf_filtered$Position,
                       thr.r2=thr.r2,  # correlation LD
                       size= 100/thr.r2, # explore
)

thinned_snps &lt;- attr(pca_inv, which="subset") # SNPs n=104958, this step outputs the integer positions of your SNPs that should be retained in the thinned set
gen_filtered_subset &lt;- GEN_imputed[, thinned_snps] # subset the full imputed dataset by the thinned SNP positions
saveRDS(gen_filtered_subset, file = "/Users/madelineeppley/Desktop/20250203_THINNEDSNPs_exp.rds")</code></pre>
</section>
<section id="other-imputation-methods" class="level2">
<h2 class="anchored" data-anchor-id="other-imputation-methods">Other imputation methods</h2>
<p>I’ve tried several different imputation methods before deciding on using LEA. Since the rest of the scripting was done in R for the Cvi MVP project, we elected to use LEA for ease of use. However, other imputation methods, such as BEAGLE, snpStats, and bigsnpr are also often used in pop gen studies. I was unsuccessful with getting bigsnpr to work on our data, but it did sound promising. Here are my notes:</p>
<p><a href="https://privefl.github.io/bigsnpr/reference/snp_fastImputeSimple.html">bigsnpr</a> is good for large datasets and will already work with the genotype matrix in its current format. This method will reduce chances of introducing structure because it compares each individual with missing SNPs to a generated “reference panel” based on the input data. It will automatically compute a reference panel based on the input genotype matrix, then each individual will be imputed based on the comparison to the reference panel. I assume it is averages across all inds in the dataset (“mean” type of approach) although you can specify method as well (mode, mean0, mean2, or random). It will output a new imputed genotype matrix in a .rds file format.</p>
</section>
<section id="environmental-data" class="level2">
<h2 class="anchored" data-anchor-id="environmental-data">Environmental Data</h2>
<p>Coming soon!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2024, Madeline Eppley</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Made with Quarto</div>
  </div>
</footer>



</body></html>